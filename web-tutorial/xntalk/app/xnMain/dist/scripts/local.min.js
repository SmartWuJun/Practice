!function(){"use strict";var e=require("electron").remote,t=["ui.router","xn.common","xn.service.interceptor","xn.talk.filter","xn.talk.service","xn.talk.method"],n=angular.module("myApp",t);n.value("xnConfig",{isDev:e.getGlobal("isDev"),platform:e.getGlobal("platform"),appInfo:JSON.parse(e.getGlobal("appInfo"))}),n.config(["$httpProvider",function(e){e.interceptors.push("httpInterceptor")}])}(),function(){var e=require("electron").remote;require("electron");angular.module("myApp").config(["$stateProvider","$urlRouterProvider",function(t,n){n.otherwise("/chat"),t.state("chat",{url:"/chat",templateUrl:e.getGlobal("dirname")+"/xnMain/page/template/chat.html",controller:"ChatController"})}])}(),function(){"use strict";angular.module("xn.talk.filter",[]).filter("substr",function(){return function(e,t){if(String.prototype.lengthB=function(){var e=0,t=this.length;if(t){for(var n=0;n<t;n++)this.charCodeAt(n)>255?e+=2:e++;return e}return 0},e){var n="";return n=t?e.lengthB()>t?e.substr(0,t)+"...":e.substr(0,t):e}}})}(),function(){"use strict";angular.module("xn.talk.method",[]).service("xnAppTool",function(){this.setStorage=function(e,t){localStorage.setItem(e,t)},this.getStorage=function(e){return localStorage.getItem(e)},this.deleteStorage=function(e){localStorage.removeItem(e)},this.clearStorage=function(e){localStorage.clear()}})}(),function(){"use strict";var e=require("electron").remote,t=require(e.getGlobal("dirname")+"/config/fun.js");angular.module("xn.talk.service",[]).config(["$httpProvider",function(e){e.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",e.defaults.withCredentials=!0,e.defaults.useXDomain=!0}]).factory("talkService",["$http",function(e){var n=require("electron").remote.getGlobal("serveUrl"),r={};return r.login=function(r){r.method="xntalk.login";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkUnionGet=function(r){r.method="xntalk.union.get";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkScanLoginCreate=function(r){r.method="xntalk.scanLogin.create";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkScanLoginGetCreate=function(r){r.method="xntalk.scanLogin.get";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkScanLoginGetCreate=function(r){r.method="xntalk.unionByAccount.get";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkGlobalSearch=function(r){r.method="xntalk.global.search";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkPassportIdByUnionIdAndTenantIdGet=function(r){r.method="xntalk.passportIdByUnionIdAndTenantId.get";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkAllTenantListGet=function(r){r.method="xntalk.allTenantList.get";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkFolderFileCreate=function(r){r.method="xntalk.folderFile.create";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkFolderDelete=function(r){r.method="xntalk.folder.delete";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkFolderMove=function(r){r.method="xntalk.folder.move";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r.xnTalkFolderFileByIdsDelete=function(r){r.method="xntalk.folderFileByIds.delete";var a=t.getPostParameter(r);return e({method:"POST",url:n,data:a.data})},r}])}(),function(){"use strict";var e=function(e){e.name="这是个应用"};angular.module("myApp").controller("ApplicationController",["$scope",e])}(),function(){"use strict";var e=require("electron").remote,t=require("electron");t.remote.BrowserWindow;angular.module("myApp").controller("BodyController",["$scope","xnConfig","talkService","xnAppTool","dialogService",function(t,n,r,a,o){function l(){r.xnTalkAllTenantListGet({unionId:a.getStorage("uid")}).success(function(e){console.log(e),null==e.errors||e.errors.length>0?o.tip(e.errors):(t.tenantList=e.result,t.global.tenant=t.tenantList[0])})}t.global={nav:1,platform:n.platform,tenant:{},showInfo:!1,appInfo:n.appInfo},t.tabNav=function(t,n){window.location.href=e.getGlobal("dirname")+"/"+t+"/page/main.html#/"+n},t.tenantList=[],l(),this.getAvatar=function(e){var t=/^((http|https|ftp):\/\/)?(\w(\:\w)?@)?([0-9a-z_-]+\.)*?([a-z0-9-]+\.[a-z]{2,6}(\.[a-z]{2})?(\:[0-9]{2,6})?)((\/[^?#<>\/\\*":]*)+(\?[^#]*)?(#.*)?)?$/i;return t.test(url)?url+"?imageView&thumbnail=80x80&quality=85":"images/default-icon.png"},t.xnTalkClose=function(){const e=require("electron").remote.dialog;var t={type:"question",title:"退出",buttons:["确定","取消"],defaultId:0,message:"确定要退出XNTALK吗？",detail:"",cancelId:1};e.showMessageBox(t,function(e){if(0==e){try{a.clearStorage()}catch(e){}require("electron").remote.app.quit()}})},t.xnTalkMaximize=function(){require("electron").remote.getCurrentWindow().isMaximized()?require("electron").remote.getCurrentWindow().restore():require("electron").remote.getCurrentWindow().maximize()},t.xnTalkMinimizable=function(){require("electron").remote.BrowserWindow.getFocusedWindow().minimize()},t.showInfo=function(e){t.global.showInfo=e}}])}(),function(){"use strict";var e=function(e,t){e.vm={keyword:"",menuActive:"conversations",conversations:1},e.doSearch=function(){},e.tabChatMenu=function(t){e.vm.menuActive=t}};angular.module("myApp").controller("ChatController",["$scope","talkService",e])}(),function(){"use strict";var e=function(e){};angular.module("myApp").controller("IndexController",["$scope",e])}(),function(){"use strict";var e=function(e,n,r,a,o,l,i){e.isShow=!0,e.page={disk:{},folderList:[],fileList:[],createFolder:!1,totalCount:0,newFolderName:{},localPath:{}},e.page.path=[],e.vm={pageNumber:1,pageSize:0,type:"ALL",sortColumn:"FILE_NAME"},e.tab=0,e.flag=!1,e.attachmentView="",e.sortColumns=[{img:"xn-icon icon-descendingorder",key:"FILE_NAME",value:"文件名"},{img:"xn-icon icon-descendingorder",key:"SIZE",value:"大小"},{img:"xn-icon icon-descendingorder",key:"CREATION_TIME",value:"最近上传"},{img:"xn-icon icon-descendingorder",key:"LAST_UPDATE_TIME",value:"修改日期"}],e.attachmentViewOpen=function(t){"img"==o("diskFileType")(t.file.extension)&&(e.attachmentView=t.path,e.attachmentState=!0)},e.attachmentViewClose=function(){e.attachmentView="",e.attachmentState=!1},$(".union-ul").on("click","li",function(){event.stopPropagation();var t=$(this).find(".logo-name").html();t.length>6&&(t=t.substr(0,5)+"..."),$("#unionName").html(t);var n=$(this).find(".logo-name").attr("data-id");$("#unionName").attr("data-id",n),$(".more-content").addClass("xn-hidden"),e.$apply(function(){tenantId=n});var r=new DiskByObjectIdRequest;r.setUnionId(userUID),r.setTenantId(tenantId),xn_http_post(r,function(t){if(null==t.errors||t.errors.length>0)i.tip(t.errors);else{e.$apply(function(){disk=t.disk,diskId=disk.id});var n=new DiskGetRequest;n.setId(diskId),n.setTenantId(tenantId),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):e.$apply(function(){e.page.disk=t.disk,e.flag=!1,e.search(e.page.disk.rootFolderId,e.page.disk.name),e.vm.plan="width:"+e.page.disk.usedSize/e.page.disk.maxSize*100+"%",e.backHome()})})}})}),e.panMenu=[{img:"xn-icon icon-allfile",key:"ALL",value:"我的文件",bb:!0,state:!0},{img:"xn-icon icon-allfile",key:"AUDIO_VIDEO",value:"企业公共",bb:!1},{img:"xn-icon icon-allfile",key:"DOCUMENT",value:"企业个人",bb:!1}],e.doMenu=function(t){if(e.tab=1,angular.forEach(e.panMenu,function(e){e.state=!1}),e.panMenu[t].state=!0,tenantId=$("#unionName").attr("data-id"),e.flag=!1,0==t){e.isShow=!0;var n=new DiskByObjectIdRequest;tenantId=0,n.setUnionId(userUID),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(console.log("网盘id"),disk=t.disk,diskId=disk.id,e.page.disk=disk,e.search(e.page.disk.rootFolderId,e.page.disk.name),e.vm.plan="width:0%",e.vm.plan="width:"+e.page.disk.usedSize/e.page.disk.maxSize*100+"%",e.backHome())})}else if(1==t){e.isShow=!0;var n=new DiskByObjectIdRequest;n.setTenantId(tenantId),xn_http_post(n,function(t){if(null==t.errors||t.errors.length>0)i.tip(t.errors);else{console.log("网盘id"),disk=t.disk,diskId=disk.id,console.log(diskId);var n=new DiskGetRequest;n.setId(diskId),n.setTenantId(tenantId),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.page.disk=t.disk,e.search(e.page.disk.rootFolderId,e.page.disk.name),e.vm.plan="width:0%",e.vm.plan="width:"+e.page.disk.usedSize/e.page.disk.maxSize*100+"%",e.backHome())})}})}else if(2==t){e.isShow=!0;var n=new DiskByObjectIdRequest;n.setTenantId(tenantId),n.setUnionId(userUID),xn_http_post(n,function(t){if(null==t.errors||t.errors.length>0)i.tip(t.errors);else{console.log("网盘id"),disk=t.disk,diskId=disk.id,console.log(diskId);var n=new DiskGetRequest;n.setId(diskId),n.setTenantId(tenantId),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.page.disk=t.disk,e.search(e.page.disk.rootFolderId,e.page.disk.name),e.vm.plan="width:0%",e.vm.plan="width:"+e.page.disk.usedSize/e.page.disk.maxSize*100+"%",e.backHome())})}})}},e.allFileShow=function(){var t=r.defer(),n=t.promise;yunXin.initUnion(t),n.then(function(t){console.log("tenantId****************************"),console.log(t),console.log(userUID);var n=new DiskByObjectIdRequest;n.setTenantId(t),xn_http_post(n,function(n){if(null==n.errors||n.errors.length>0)i.tip(n.errors);else{console.log("网盘id"),disk=n.disk,diskId=disk.id,console.log(diskId);var r=new DiskGetRequest;r.setId(diskId),r.setTenantId(t),xn_http_post(r,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.page.disk=t.disk,t.disk.trashFolderId&&(e.folderDelete={name:"回收站",creationTime:t.disk.creationTime,lastUpdateTime:t.disk.lastUpdateTime,id:t.disk.trashFolderId}),e.flag=!1,e.search(e.page.disk.rootFolderId,e.page.disk.name),e.vm.plan="width:"+e.page.disk.usedSize/e.page.disk.maxSize*100+"%",e.backHome())})}})})},e.allFileShow(),e.backHome=function(){e.page.folderList=[],e.page.folderDelete=[],e.page.fileList=[],e.page.totalCount=2,e.page.path=[]},e.sortName="文件名",e.sortColumn=function(t){"FILE_NAME"==t&&(e.vm.sortColumn=t,e.sortName="文件名"),"SIZE"==t&&(e.vm.sortColumn=t,e.sortName="大小"),"CREATION_TIME"==t&&(e.vm.sortColumn=t,e.sortName="最近上传"),"LAST_UPDATE_TIME"==t&&(e.vm.sortColumn=t,e.sortName="修改日期"),e.flag=!0,e.search(e.page.disk.rootFolderId,e.page.disk.name,e.flag)},e.search=function(t,n){console.log("folderId folderName"),console.log(t,n),e.vm.parentId=t,e.vm.parentName=n;var r=new FolderFileFindRequest;r.setTenantId(tenantId),r.setParentId(t),r.setSortColumn(e.vm.sortColumn),xn_http_post(r,function(r){if(null==r.errors||r.errors.length>0)i.tip(r.errors);else{if(console.log("文件夹******************************"),console.log(r),e.page.fileList=[],e.page.folderList=[],e.page.folderDelete=[],null!=r.folderFileList){e.$apply(function(){e.page.fileList=r.folderFileList}),console.log("页面显示folderfileList*******************"),console.log(e.page.fileList);for(var a=0,l=r.folderFileList.length;a<l;a++)"img"==o("diskFileType")(e.page.fileList[a].file.extension)?(e.page.fileList[a].newlineImgUrl={"background-image":'url("'+e.page.fileList[a].path+'@40w_34h_0e")'},e.page.fileList[a].newImgUrl={"background-image":'url("'+e.page.fileList[a].path+'@85w_68h_0e")'}):(e.page.fileList[a].newlineImgUrl="",e.page.fileList[a].newimgUrl=""),e.$apply(function(){e.page.fileList[a].state=!1})}if(null!=r.folderList){console.log("所有文件******************************"),e.$apply(function(){e.page.folderList=r.folderList});for(var s=0;s<e.page.folderList.length;s++)e.$apply(function(){e.page.folderList[s].state=!1,e.page.folderList[s].lastClick=0})}e.$apply(function(){e.page.totalCount=r.totalCount}),e.flag||null!=n&&(console.log("添加："+t+":"+n),e.page.path.push({id:t,name:n})),e.$apply(function(){e.page.localPath=t,e.page.createFolder=!1})}})},e.getList=function(){e.search(e.page.localPath)},e.folderSingleClick=function(t){console.log("folder****************************"),console.log(t);var n=(new Date).getTime();n-t.lastClick<500?e.search(t.id,t.name):(t.lastClick=n,t.state=!t.state)},e.fileSingleClick=function(e){var t=(new Date).getTime();t-e.lastClick<500||(e.lastClick=t,e.state=!e.state)},e.keydown=function(e){console.log("in keydown"),console.log(e.keyCode)},e.keyup=function(e){console.log("in keyup"),console.log(e.keyCode)},e.allSelect=function(){for(var t=0;t<e.page.folderList.length;t++)e.page.folderList[t].state=!e.page.folderList[t].state;for(var n=0;n<e.page.fileList.length;n++)e.page.fileList[n].state=!e.page.fileList[n].state},e.checkLenght=0,e.batchDownload=function(){for(var t=0;t<e.page.fileList.length;t++)e.page.fileList[t].state&&e.checkLenght++;if(!e.checkLenght)return void i.tip([{message:"请选择要下载的文件"}]);e.checkLenght=0;for(var t=0;t<e.page.fileList.length;t++)if(e.page.fileList[t].state){var n=require("electron"),r=n.remote.BrowserWindow;mainWindow=new r({frame:!1,resizable:!1,center:!0,useContentSize:!0,"class":"Main",width:900,height:600,minWidth:900,webPreferences:{webSecurity:!1,allowDisplayingInsecureContent:!0}}),mainWindow.setMenuBarVisibility(!1),mainWindow.loadURL(e.page.fileList[t].path)}},e.jumpTo=function(t,n){for(var r=0;r<e.page.path.length;r++)if(t===e.page.path[r].id){e.page.path=e.page.path.slice(0,r);break}e.flag=!1,e.search(t,n)},e.showCreateFolder=function(){for(var t=0,n=!0,r=0;r<e.page.folderList.length;r++){var a=e.page.folderList[r];if("新建文件夹"==a.name){n=!1;break}}for(;!n;)for(t++,n=!0,r=0;r<e.page.folderList.length;r++)if(a=e.page.folderList[r],"新建文件夹("+t+")"==a.name){n=!1;break}0==t?e.page.newFolderName="新建文件夹":e.page.newFolderName="新建文件夹("+t+")",e.page.createFolder=!0},e.createFolderFile=function(){e.folder={parentId:e.page.path[e.page.path.length-1].id,name:e.page.newFolderName},console.log("this is param "+e.folder);var t=new FolderCreateRequest;t.setName(e.folder.name),t.setParentId(e.folder.parentId),t.setTenantId(tenantId),t.setDiskId(diskId),xn_http_post(t,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.page.createFolder=!1,e.flag=!1,e.search(e.page.localPath))})},e.renameFolder=function(t){var n=new FolderUpdateRequest;n.setName(t.name),n.setTenantId(tenantId),n.setId(t.id),n.setRowVersion(t.rowVersion),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath))})},e.openSelectFolder=function(n,r){var o=a.open({templateUrl:"selectFolder.html",controller:t,size:"",resolve:{diskId:function(){return e.page.disk.id},rootId:function(){return e.page.disk.rootFolderId},object:function(){return r}}});o.result.then(function(t){"folder"==n?e.moveFolder(t,r):e.moveFile(t,r),e.flag=!1,e.search(e.page.localPath)},function(){})},e.moveFolder=function(t,n){e.param={folderId:n.id,targetId:t,rowVersion:n.rowVersion};var r={folderId:e.param.folderId,targetId:e.param.targetId,tenantId:tenantId,rowVersion:e.param.rowVersion};l.xnTalkFolderMove(r).then(function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath),e.$apply())})},e.deleteFolder=function(t){var n={size:"sm"},r={closeButtonText:"取消",actionButtonText:"确定删除",headerText:"删除文件夹",bodyText:"您确定要删除该文件夹吗？",callback:function(){e.folder={id:t};var n={id:e.folder.id,tenantId:tenantId};l.xnTalkFolderDelete(n).then(function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath))})}};i.confirm(n,r)},e.list={folderIdList:[],folderFileIdList:[]},e.batchDeleteFolder=function(){for(var t=0,n=0,r=0;r<e.page.folderList.length;r++)0==e.page.folderList[r].state&&t++;for(var a=0;a<e.page.fileList.length;a++)0==e.page.fileList[a].state&&n++;if(t==e.page.folderList.length&&n==e.page.fileList.length)return void i.tip([{message:"请选择需要删除的文件"}]);var o={size:"sm"},s={closeButtonText:"取消",actionButtonText:"确定删除",headerText:"删除文件?",bodyText:"您确定要删除吗？",callback:function(){for(var t=0;t<e.page.folderList.length;t++)e.page.folderList[t].state&&e.list.folderIdList.push(e.page.folderList[t].id);for(var n=0;n<e.page.fileList.length;n++)e.page.fileList[n].state&&e.list.folderFileIdList.push(e.page.fileList[n].id);var r={folderFileIdList:e.list.folderFileIdList,folderIdList:e.list.folderIdList,tenantId:tenantId};l.xnTalkFolderFileByIdsDelete(r).then(function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath),e.list.folderIdList=[],e.list.folderFileIdList=[],e.all.state=!1)});var a=new DiskGetRequest;a.setId(diskId),a.setTenantId(tenantId),xn_http_post(a,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):e.$apply(function(){e.page.disk=t.disk})})}};i.confirm(o,s)},e.uploadFile=function(){var t=document.getElementById("attachment");t.onchange=function(){for(var t=document.getElementById("attachment").files,n=0;n<t.length;n++){var r=t[n],a=new FileReader;a.readAsDataURL(r),a.onload=function(){document.getElementById("attachment").src=a.result,console.log(a.result),e.doUpload()},e.doUpload=function(){var t=new FolderFileCreateRequest;t.setTenantId(tenantId),t.setDiskId(e.page.disk.id),t.setFileData(a.result),t.setFileExt(r.type),t.setFileName(r.name),t.setFolderId(e.page.path[e.page.path.length-1].id),xn_http_post(t,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(i.tip("上传成功！"),e.search(e.page.localPath))})}}}},e.renameFile=function(t){var n=new FolderFileUpdateRequest;n.setId(t.id),n.setFileName(t.fileName),n.setTenantId(tenantId),n.setRowVersion(t.rowVersion),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath))})},e.moveFile=function(t,n){e.param={id:n.id,targetId:t,rowVersion:n.rowVersion};var r=new FolderFileMoveRequest;r.setId(e.param.id),r.setTenantId(tenantId),r.setTargetId(e.param.targetId),r.setRowVersion(e.param.rowVersion),xn_http_post(r,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath),e.$apply())})},e.deleteFile=function(t){var n={size:"sm"},r={closeButtonText:"取消",actionButtonText:"确定删除",headerText:"删除文件",bodyText:"您确定要删除吗？",callback:function(){e.file={id:t};var n=new FolderFileDeleteRequest;n.setId(e.file.id),n.setTenantId(tenantId),xn_http_post(n,function(t){null==t.errors||t.errors.length>0?i.tip(t.errors):(e.flag=!1,e.search(e.page.localPath),e.$apply())})}};i.confirm(n,r)},e.download=function(e){},e.openFile=function(e){},angular.element(".rightClick").bind("contextmenu",function(e){e.preventDefault()})},t=function(e,t,n,r,a,o,l){e.param={diskId:a,pageNumber:1,pageSize:0},e.trees=[],e.allTrees=[],e.collapsed=!1,e.selectTarget=function(e){t.close(e.id)};var i=function(t,n,r){r++,angular.forEach(n,function(a){a.parentId===t&&a.id!=l.id&&(a.level=r,a.visable=!1,e.allTrees.push(a),i(a.id,n,r))})},s=function(t,n){angular.forEach(e.allTrees,function(e){e.id===t&&(n.push(e),s(e.parentId,n))})},d=function(t,n){angular.forEach(e.allTrees,function(e){e.parentId===t&&(n.push(e),d(e.id,n))})},c=new FolderFindRequest;c.setDiskId(e.param.diskId),c.setTenantId(tenantId),c.setPageSize(0),xn_http_post(c,function(t){if(null==t.errors||t.errors.length>0)dialogService.tip(t.errors);else if(t.result.length>0){angular.forEach(t.result,function(n){n.id==o&&n.id!=l.id&&(n.level=0,n.visable=!0,e.allTrees.push(n),i(n.id,t.result,0))});for(var n=0;n<e.allTrees.length-1;n++)e.allTrees[n].id==e.allTrees[n+1].parentId?(e.allTrees[n].childState=!0,e.allTrees[n].collapsed=!0):(e.allTrees[n].childState=!1,e.allTrees[n].collapsed=!1);e.allTrees[e.allTrees.length-1].childState=!1,angular.extend(e.trees,e.allTrees),console.log("文件夹……………………………………………………………………………………………………"),console.log(e.trees),e.$apply()}}),e.collapseTree=function(t,n){angular.forEach(t,function(r){r.parentId===n.id&&(r.visable=!n.collapsed&&n.visable,e.collapseTree(t,r))})},e.toggle=function(t){e.trees[t].collapsed=!e.trees[t].collapsed,e.collapseTree(e.trees,e.trees[t])},e["delete"]=function(t){var n={size:"sm"},r={closeButtonText:"取消",actionButtonText:"确定删除",headerText:"继续....?",bodyText:"您确定要删除组织吗？",callback:function(){HrService.apiHrOrgDelete({id:t.id}).success(function(n){if(null===n.errors||n.errors.length>0)dialogService.tip(n.errors);else{var r=function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.id)return n},a=function(e,t){for(var n=0,r=0;r<t.length;r++)t[r].parentId===e.parentId&&n++;return n},o=function(e,t){for(var n=0;n<t.length;n++)if(t[n].id===e.parentId)return n};1===a(t,e.trees)&&null!=o(t,e.trees)&&(e.trees[o(t,e.trees)].childState=!1),1===a(t,e.allTrees)&&null!=o(t,e.allTrees)&&(e.allTrees[o(t,e.allTrees)].childState=!1),e.trees.splice(r(t,e.trees),1),e.allTrees.splice(r(t,e.allTrees),1),dialogService.tip([{message:"删除成功！"}])}})}};dialogService.confirm(n,r)},e.edit=function(t){e.org={},angular.extend(e.org,t);var n=r.open({templateUrl:"treeEidt.html",controller:TreeEidt,size:"",resolve:{items:function(){return e.org}}});n.result.then(function(t){var n=function(t,n){for(var r=0;r<n.length;r++)if(e.trees[r].id==t.id)return r};e.trees.splice(n(t,e.trees),1,t),e.allTrees.splice(n(t,e.allTrees),1,t)})},e.addTree=function(t){e.org={},null!=t?e.org={parentName:t.name,parentId:t.id}:e.org={parentName:"",parentId:""};var n=r.open({templateUrl:"treeEidt.html",controller:TreeEidt,size:"",resolve:{items:function(){return e.org}}});n.result.then(function(t){var n=function(e,t){for(var n=0;n<t.length;n++)if(t[n].id==e.parentId)return n},r=function(e,t){for(var n=t.length-1;n>=0;n--)if(t[e].id==t[n].parentId)return r(n,t);return e};if(""==t.parentId)t.childState=!1,t.collapsed=!1,t.visable=!0,t.level=0,e.trees.push(t),e.allTrees.push(t);else{e.trees[n(t,e.trees)].childState=!0,e.trees[n(t,e.trees)].collapsed=!1;for(var a=0;a<e.trees.length;a++)e.trees[a].parentId===t.parentId&&(e.trees[a].visable=!0);t.childState=!1,t.collapsed=!1,t.visable=!0,t.level=e.trees[n(t,e.trees)].level+1,e.trees.splice(r(n(t,e.trees),e.trees)+1,0,t),e.allTrees.splice(r(n(t,e.allTrees),e.allTrees)+1,0,t)}})},e.treeSearch=function(){e.organizationSearch=[],null!=e.keyword?e.SearchName(e.allTrees,e.keyword):angular.extend(e.organizationSearch,e.allTrees),e.trees=e.organizationSearch},e.SearchName=function(t,n){for(var r=n.length,a=t,o=0;o<a.length;o++){for(var l=a[o],i=l.name,c=i.length,u=!1,p=0;p<c-r+1;p++)if(n==i.substring(p,p+r)){u=!0;break}if(u){var g=0;if(null!=l.parentId){var f=[];for(s(l.parentId,f),g=f.length-1;g>=0;g--)f[g].collapsed=!1,f[g].visable=!0,e.organizationSearch.push(f[g])}var h={};angular.extend(h,l);var m=[];if(d(l.id,m),0==m.length)h.collapsed=!1,h.visable=!0,e.organizationSearch.push(h);else{for(h.collapsed=!0,h.visable=!0,e.organizationSearch.push(h),g=0;g<m.length;g++)e.organizationSearch.push(m[g]);o+=m.length}}}},e.clean=function(){e.organization=null},e.move=function(){},e.cancel=function(){t.dismiss("cancel")},e.closeAlert=function(e,t){t.splice(e,1)}};angular.module("myApp").filter("fileSize",function(){return function(e){if(e)return e<1024?e+"B":e<1048576?Math.round(e/1024)+"KB":e<1073741824?(e/1024/1024).toFixed(2)+"MB":(e/1024/1024/1024).toFixed(2)+"GB"}}).filter("diskFileType",[function(){return function(e){switch(e){case"folder":e="folder";break;case"xlsx":case"xls":e="xls";break;case"docx":case"doc":e="doc";break;case"pptx":case"ppt":e="ppt";break;case"txt":e="txt";break;case"pdf":e="pdf";break;case"zip":case"rar":e="zip";break;case"jpeg":case"jpg":case"png":case"gif":e="img";break;default:e="other"}return e}}]).controller("PanController",["$scope","$http","$modal",e]).controller("PanController",["$scope","$http","$q","$modal","$filter","talkService","dialogService",e]).controller("FolderController",["$scope","$modalInstance","$http","$modal","diskId","dialogService","toolsService",t])}();